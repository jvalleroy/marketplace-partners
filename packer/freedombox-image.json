{
    "variables": {
	"token": "{{env `DIGITALOCEAN_TOKEN`}}",
	"image_name": "freedombox-{{timestamp}}",
	"apt_packages": "freedombox"
    },
    "builders": [
	{
	    "type": "digitalocean",
	    "api_token": "{{user `token`}}",
	    "image": "debian-10-x64",
	    "region": "nyc3",
	    "size": "s-1vcpu-1gb",
	    "ssh_username": "root",
	    "snapshot_name": "{{user `image_name`}}"
	}
    ],
    "provisioners": [
	{
	    "type": "shell",
	    "inline": [
		"cloud-init status --wait",
		"apt -qqy update",
		"apt -qqy -o Dpkg::Options::='--force-confdef' -o Dpkg::Options::='--force-confold' full-upgrade",
		"DEBIAN_FRONTEND=noninteractive apt -qqy -o Dpkg::Options::='--force-confdef' -o Dpkg::Options::='--force-confold' install {{user `apt_packages`}}"
	    ]
	},
	{
	    "type": "shell",
	    "scripts": [
		"scripts/90-cleanup.sh",
		"scripts/99-img_check.sh"
	    ]
	}
    ]
}
